# 严格模式

长久以来，JavaScript 不断向前发展且并未带来任何兼容性问题。新的特性被加入，旧的功能也没有改变。

这么做有利于兼容旧代码，但缺点是 JavaScript 创造者的任何错误或不完善的决定也将永远被保留在 JavaScript 语言中。

这种情况一直持续到 2009 年 ECMAScript 5 (ES5) 的出现。ES5 规范增加了新的语言特性并且修改了一些已经存在的特性。为了保证旧的功能能够使用，大部分的修改是默认不生效的。你需要一个特殊的指令 —— `"use strict"` 来明确地激活这些特性。

## 启用

`"use strict"` 语句是一行字符串，当它出现在脚本文件的顶部时，则整个脚本文件都将以严格模式来工作，比如：

```js
"use strict";

// 整个脚本文件都以严格模式来工作
...
```

如果将 `"use strict"` 放在函数体的开头，则只在该函数中启用严格模式，比如：

```js
function f() {
    "use strict";
    
    // 只有该函数启用严格模式
    ...
}
```

> 注意：当 `"use strict"` 出现在脚本文件或函数体的顶部时，才能启用严格模式，否则将静默失败，例外的是，注释可以出现在 `"use strict"` 的上面。

## 禁用

没有办法取消严格模式。

## 浏览器控制台

默认情况下，浏览器的开发者控制台是不启用严格模式的，如果你想启用，可以首先尝试搭配使用 `shift+Enter` 按键来输入多行代码，然后将 `"use strict"` 放在顶部，就像这样：

```js
"use strict";
// Shift+Enter 换行
// ...你的代码
// 按下 Enter 来运行
```

这个办法在大部分现代浏览器中都有效，如果依然不行，还有另一种很丑但可靠的方法，就像这样：

```js
( function() {
    "use strict";
    // ...你的代码
} )();
// 按下 Enter 来运行
```

## classes 和 modules 会自动启用严格模式

如题所述， `class` 内的代码和模块脚本都会自动启用严格模式。

## 影响

在严格模式中，以下操作会触发错误，在非严格模式中则不会：

- 使用 `with` （废弃） ；
- 对未声明的变量进行赋值；
-  `delete` 变量；
- 重复使用属性名，比如：  `{a: 1, a: 2}` ；
- 重复使用参数名，比如：  `function f(a, a) {}` ；
- 重写不可写的数据属性；
- 删除不可配置的数据属性；
- 在块语句内声明一个函数，比如 `if (1) { function f(){} }` ；
- 使用保留字来命名变量；
- 使用以  `0` 为前缀的八进制语法（淘汰）；
- 使用  `arguments.callee`  、  `arguments.caller`  、  `anyFunction.caller`  、  `anyFunction.arguments ` ；

此外，严格模式下的 `this` 的行为也有不同，具体是：

- 普通函数中的 `this` 的值：
  - 非严格模式下，指向 `window` 对象。
  - 严格模式下，值是 `undefined` 。

-  `call` 或 `apply` 调用模式中的 `this` 的值：
  - 非严格模式下：
    - 若入参是 `null` 或 `undefined` ，则指向 `window` 对象。
    - 若入参是 `number` 或 `bigint` 或 `string` 或 `boolean` 或 `symbol` 类型的原始值，则指向这个原始值的包装对象。
  - 严格模式下， `this` 的值就是入参。